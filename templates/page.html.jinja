{# ui-version:2025-08-11-v6 #}
<article class="page">
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <a href="/">Start</a> <span aria-hidden="true">‚Ä∫</span>
    <a href="/hubs.html">Brettspiele</a> <span aria-hidden="true">‚Ä∫</span>
    <span aria-current="page">{{ game.title }}</span>
  </nav>

  <header class="hero">
    <h1 class="title">{{ game.title }}</h1>
    {% if game.subtitle %}<p class="subtitle">{{ game.subtitle }}</p>{% endif %}
    <ul class="chips">
      {% if game.players %}<li class="chip">üë• {{ game.players.min }}‚Äì{{ game.players.max }} Spieler</li>{% endif %}
      {% if game.playtime %}<li class="chip">‚è±Ô∏è {{ game.playtime.min }}‚Äì{{ game.playtime.max }} Min</li>{% endif %}
      {% if game.complexity %}<li class="chip">üß† Komplexit√§t {{ '%.1f'|format(game.complexity) }}</li>{% endif %}
      {% if game.year %}<li class="chip">üìÖ {{ game.year }}</li>{% endif %}
    </ul>
  </header>

  {% set good = (game.price_rules.good_threshold_eur if game.price_rules else None) %}
  {% set ok = (game.price_rules.ok_threshold_eur if game.price_rules else None) %}

  <section class="price-indicator">
    <div class="pi-head">
      <h2 class="h2 pi-title">
        Preisindikator
        <button type="button" class="info-badge" aria-label="Erkl√§rung zum Preisindikator" aria-expanded="false">
          ‚ìò
          <span class="tip" role="tooltip">
            <strong>So liest du das:</strong> Wir setzen drei Bereiche. Liegt ein Angebot <em>unter {{ '%.0f'|format(good or 0) }} ‚Ç¨</em>,
            markieren wir es als <strong>Top-Deal</strong>. Bis <em>{{ '%.0f'|format(ok or 0) }} ‚Ç¨</em> ist der Preis in Ordnung.
            Dar√ºber ist es eher teuer. Die Schwellen basieren auf typischen Marktpreisen &amp; Erfahrungswerten.
            <br><em>Transparenz:</em> Links sind Affiliate-Links. F√ºr dich √§ndert sich der Preis nicht.
          </span>
        </button>
      </h2>
    </div>
    {% if good and ok %}
      <div class="legend">
        <span class="legend-item"><span class="swatch good"></span> <strong>gut</strong>: unter {{ '%.0f'|format(good) }} ‚Ç¨</span>
        <span class="legend-item"><span class="swatch ok"></span> <strong>ok</strong>: bis {{ '%.0f'|format(ok) }} ‚Ç¨</span>
        <span class="legend-item"><span class="swatch high"></span> <strong>teuer</strong>: dar√ºber</span>
      </div>
    {% else %}
      <p class="muted">F√ºr dieses Spiel haben wir noch keine Preisschwellen hinterlegt.</p>
    {% endif %}
    <div class="cta-row">
      <a class="btn btn-primary" href="#angebote">Jetzt Angebote ansehen</a>
    </div>
  </section>

  <details class="help-details">
    <summary>Wie funktioniert diese Seite?</summary>
    <div class="help-body">
      <ol class="steps">
        <li><strong>Kaufberatung:</strong> F√ºr wen passt das Spiel? Was beachten?</li>
        <li><strong>Preisindikator:</strong> Einordnung gut/ok/teuer &amp; Top-Deals.</li>
        <li><strong>Angebote:</strong> Aktualisierte eBay-Listings in EUR. ‚ÄûZum Angebot‚Äú √∂ffnet eBay.</li>
        <li><strong>Checkliste &amp; FAQs:</strong> Hilfe f√ºr Gebrauchtkauf &amp; h√§ufige Fragen.</li>
      </ol>
    </div>
  </details>

  <section class="content-section">
    <h2 class="h2">Kaufberatung</h2>
    {% set primary_text = game.summary or game.description or game.about or game.intro or game.overview or game.text %}
    {% set paragraphs = game.kaufberatung or game.paragraphs or game.extra_paragraphs %}
    {% if primary_text %}<p>{{ primary_text }}</p>{% endif %}
    {% if paragraphs %}{% for p in paragraphs %}<p>{{ p }}</p>{% endfor %}{% endif %}
    {% if not primary_text and not paragraphs %}
      <p class="muted">Keine Details hinterlegt ‚Äì wir erg√§nzen diese Seite bald.</p>
    {% endif %}
  </section>

  {% set cl = game.get('checklist') or game.get('checklist_buy') %}
  {% if cl %}
  <section class="content-section">
    <h2 class="h2">Gebrauchtkauf ‚Äì Checkliste</h2>
    <ul class="checklist">
      {% if cl is mapping %}
        {% for k,v in cl.items() %}<li><strong>{{ k }}:</strong> {{ v }}</li>{% endfor %}
      {% else %}
        {% for item in cl %}
          {% if item is mapping %}
            {% for k,v in item.items() %}<li><strong>{{ k }}:</strong> {{ v }}</li>{% endfor %}
          {% else %}
            <li>{{ item }}</li>
          {% endif %}
        {% endfor %}
      {% endif %}
    </ul>
  </section>
  {% endif %}

  <section class="offers" id="angebote">
    <div class="offers-head">
      <h2 class="h2">Angebote</h2>
      <small class="muted">Sortierung nach Preis (aufsteigend), nur Angebote in EUR.</small>
    </div>

    {% if offers and offers|length > 0 %}
      <div class="offer-grid">
        {% for o in offers %}
          {% set is_top = (good and o.price_eur is number and o.price_eur <= good) %}
          <article class="offer-card{% if is_top %} top{% endif %}">
            {% if is_top %}<div class="badge">Top-Deal</div>{% endif %}
            {% if o.is_accessory %}<div class="badge badge-grey" title="Zubeh√∂r/Erweiterung">Zubeh√∂r</div>{% endif %}
            {% if o.image_url %}<img class="offer-img" src="{{ o.image_url }}" alt="" loading="lazy">{% endif %}
            <h3 class="offer-title">{{ o.title }}</h3>
            <div class="offer-meta">
              <span class="price">{% if o.price_eur is number %}{{ '%.2f'|format(o.price_eur) }} ‚Ç¨{% else %}‚Äì{% endif %}</span>
              {% if o.condition %}<span class="condition">{{ o.condition }}</span>{% endif %}
            </div>
            <a class="btn btn-secondary" href="{{ o.url }}" target="_blank" rel="nofollow sponsored noopener">Zum Angebot</a>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">Gerade keine passenden Angebote. Schau sp√§ter wieder vorbei ‚Äì die Seite aktualisiert sich regelm√§√üig.</p>
    {% endif %}
  </section>

  {% if game.alternatives %}
  <section class="content-section">
    <h2 class="h2">Alternativen</h2>
    <ul class="alt-list">
      {% for alt in game.alternatives %}
        {% set atitle = (alt.title if alt is mapping else alt) %}
        {% set aurl = (alt.url if alt is mapping else None) %}
        {% set aslug = (alt.slug if (alt is mapping and alt.slug) else None) %}
        <li>
          {% if aurl %}
            <a href="{{ aurl }}">{{ atitle }}</a>
          {% elif aslug %}
            <a href="/spiel/{{ aslug }}/">{{ atitle }}</a>
          {% else %}
            {{ atitle }}
          {% endif %}
          {% if alt is mapping and alt.note %}<span class="muted"> ‚Äì {{ alt.note }}</span>{% endif %}
        </li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  {% set faq_items = game.faq or game.faqs or game.faq_list %}
  {% if faq_items %}
  <section class="content-section">
    <h2 class="h2">H√§ufige Fragen</h2>
    <div class="faq">
      {% for q in faq_items %}
        {% if q is mapping %}
          {% set question = q.question or q.q or (q.keys()|list)[0] %}
          {% set answer = q.answer or q.a or (q[question] if q[question] is defined else '') %}
        {% else %}
          {% set question = q %}
          {% set answer = "" %}
        {% endif %}
        <details>
          <summary>{{ question }}</summary>
          {% if answer %}<div class="answer"><p>{{ answer }}</p></div>{% endif %}
        </details>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <section class="content-section">
    <a class="btn btn-link" href="/">‚Üê Zur √úbersicht</a>
  </section>

  {% set prices = (offers | map(attribute='price_eur') | reject('equalto', None) | list) if offers else [] %}
  {% set low = (prices|min) if prices else 0 %}
  {% set high = (prices|max) if prices else 0 %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "{{ game.title|e }}",
    "category": "Board game",
    {% if game.year %}"releaseDate": "{{ game.year }}",{% endif %}
    {% if offers and offers|length > 0 %}
    "offers": {
      "@type": "AggregateOffer",
      "priceCurrency": "EUR",
      "lowPrice": "{{ '%.2f'|format(low) }}",
      "highPrice": "{{ '%.2f'|format(high) }}",
      "offerCount": "{{ offers|length }}"
    },
    {% endif %}
    "url": "{{ (canonical or site_url ~ '/spiel/' ~ game.slug ~ '/')|e }}"
  }
  </script>
</article>
